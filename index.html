<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Over Gold - Cristian</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b121d; color: white; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        h1 { color: #facc15; text-align: center; font-size: 3em; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #8b949e; margin-bottom: 30px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #161b22; padding: 20px; border-radius: 15px; border: 1px solid #30363d; }
        .valor { font-size: 2em; font-weight: bold; color: #facc15; margin: 10px 0; }
        .analisis { padding: 5px 10px; border-radius: 5px; font-size: 0.8em; font-weight: bold; }
        .buy { background: #064e3b; color: #10b981; }
        .wait { background: #422006; color: #f59e0b; }
        
        /* SecciÃ³n de Noticias */
        .news-section { margin-top: 40px; background: #161b22; padding: 20px; border-radius: 15px; border: 1px solid #30363d; }
        .news-item { border-bottom: 1px solid #30363d; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .news-item:last-child { border: none; }
        .news-title { font-weight: bold; color: #38bdf8; text-decoration: none; font-size: 0.9em; }
        .sentiment { font-size: 0.7em; padding: 3px 7px; border-radius: 4px; background: #334155; }

        button { background: #facc15; color: #0b121d; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; display: block; margin: 20px auto; }
    </style>
</head>
<body>

<div class="container">
    <h1>OVER GOLD</h1>
    <p class="subtitle">Terminal de Inteligencia Financiera</p>
    
    <button onclick="actualizarTodo()">ðŸ”„ Sincronizar Todo</button>

    <div class="grid">
        <div class="card">
            <div id="a-nvda" class="analisis wait">Analizando...</div>
            <h3>Nvidia (NVDA)</h3>
            <div id="p-nvda" class="valor">...</div>
            <canvas id="chart-nvda"></canvas>
        </div>
        <div class="card">
            <div id="a-oro" class="analisis wait">Analizando...</div>
            <h3>Oro (Gold)</h3>
            <div id="p-oro" class="valor">...</div>
            <canvas id="chart-oro"></canvas>
        </div>
        <div class="card">
            <div id="a-pet" class="analisis wait">Analizando...</div>
            <h3>PetrÃ³leo (WTI)</h3>
            <div id="p-pet" class="valor">...</div>
            <canvas id="chart-pet"></canvas>
        </div>
    </div>

    <div class="news-section">
        <h3>Noticias del Mercado Mundial</h3>
        <div id="noticias-container">Cargando noticias...</div>
    </div>
</div>

<audio id="audioAlerta" src="https://www.soundjay.com/misc/sounds/cash-register-05.mp3"></audio>

<script>
const API_KEY = 'HOBELI497HGCKGJ6';

async function actualizarTodo() {
    try {
        // 1. Obtener Precios
        const d_nvda = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=NVDA&apikey=${API_KEY}`).then(r => r.json());
        const p_nvda = parseFloat(d_nvda['Global Quote']['05. price']);
        
        // LÃ³gica de Sonido: Si el cambio es negativo (oportunidad), suena
        const cambio = parseFloat(d_nvda['Global Quote']['10. change percent']);
        if (cambio < -0.5) { 
            document.getElementById('audioAlerta').play();
            document.getElementById('a-nvda').innerText = "Â¡OPORTUNIDAD DE COMPRA!";
            document.getElementById('a-nvda').className = "analisis buy";
        } else {
            document.getElementById('a-nvda').innerText = "ESPERAR";
            document.getElementById('a-nvda').className = "analisis wait";
        }
        document.getElementById('p-nvda').innerText = "$" + p_nvda.toFixed(2);
        dibujar('chart-nvda', [p_nvda*1.02, p_nvda*0.98, p_nvda*1.01, p_nvda], '#10b981');

        // 2. Obtener Noticias
        const d_news = await fetch(`https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=AAPL,TSLA,NVDA&apikey=${API_KEY}`).then(r => r.json());
        mostrarNoticias(d_news.feed.slice(0, 5));

    } catch (e) { console.log("LÃ­mite de API alcanzado"); }
}

function mostrarNoticias(noticias) {
    const container = document.getElementById('noticias-container');
    container.innerHTML = noticias.map(n => `
        <div class="news-item">
            <a href="${n.url}" target="_blank" class="news-title">${n.title}</a>
            <span class="sentiment">${n.overall_sentiment_label}</span>
        </div>
    `).join('');
}

function dibujar(id, datos, color) {
    new Chart(document.getElementById(id), {
        type: 'line',
        data: {
            labels: datos.map((_, i) => i),
            datasets: [{ data: datos, borderColor: color, tension: 0.3, fill: false }]
        },
        options: {
            scales: {
                x: { ticks: { color: '#8b949e' } },
                y: { ticks: { color: '#8b949e' } }
            },
            plugins: { legend: { display: false } }
        }
    });
}

actualizarTodo();
</script>
</body>
</html>
