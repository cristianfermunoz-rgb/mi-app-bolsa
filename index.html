<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor Global - Cristian</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 20px; margin: 0; }
        .container { max-width: 1100px; margin: auto; }
        h1 { color: #38bdf8; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: #1e293b; padding: 15px; border-radius: 15px; border: 1px solid #334155; }
        .label { color: #94a3b8; font-size: 0.9em; text-transform: uppercase; }
        .valor { font-size: 2em; font-weight: bold; color: #00ff88; margin: 5px 0; }
        canvas { width: 100% !important; height: 150px !important; margin-top: 10px; }
        .btn-container { text-align: center; margin-bottom: 20px; }
        button { background: #38bdf8; color: #0f172a; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button:hover { background: #7dd3fc; }
    </style>
</head>
<body>

<div class="container">
    <h1>Global Market Monitor</h1>
    <div class="btn-container">
        <button onclick="actualizarTodo()">ðŸ”„ Actualizar Mercado</button>
    </div>

    <div class="grid">
        <div class="card">
            <div class="label">AcciÃ³n: Nvidia (NVDA)</div>
            <div id="p-nvda" class="valor">Cargando...</div>
            <canvas id="chart-nvda"></canvas>
        </div>

        <div class="card">
            <div class="label">Metal: Oro (Gold)</div>
            <div id="p-oro" class="valor">Cargando...</div>
            <canvas id="chart-oro"></canvas>
        </div>

        <div class="card">
            <div class="label">Metal: Plata (Silver)</div>
            <div id="p-plata" class="valor">Cargando...</div>
            <canvas id="chart-plata"></canvas>
        </div>

        <div class="card">
            <div class="label">Divisa: EUR / USD</div>
            <div id="p-dolar" class="valor">Cargando...</div>
            <canvas id="chart-dolar"></canvas>
        </div>
    </div>
</div>

<script>
// TU LLAVE CORREGIDA CON COMILLAS
const API_KEY = 'HOBELI497HGCKGJ6'; 

async function fetchAPI(url) {
    const res = await fetch(url);
    const data = await res.json();
    if (data["Note"]) {
        throw new Error("LÃ­mite de API alcanzado");
    }
    return data;
}

function crearMiniGrafica(id, etiqueta, datos, color) {
    const ctx = document.getElementById(id).getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: datos.map((_, i) => i),
            datasets: [{
                label: etiqueta,
                data: datos,
                borderColor: color,
                backgroundColor: color + '22',
                fill: true,
                borderWidth: 2,
                pointRadius: 0,
                tension: 0.4
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
        }
    });
}

async function actualizarTodo() {
    try {
        // 1. Nvidia
        const d_nvda = await fetchAPI(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=NVDA&apikey=${API_KEY}`);
        const p_nvda = parseFloat(d_nvda['Global Quote']['05. price']);
        document.getElementById('p-nvda').innerText = "$" + p_nvda.toFixed(2);
        crearMiniGrafica('chart-nvda', 'NVDA', [p_nvda*0.98, p_nvda*0.99, p_nvda*0.97, p_nvda], '#00ff88');

        // 2. Oro
        const d_oro = await fetchAPI(`https://www.alphavantage.co/query?function=GOLD&interval=monthly&apikey=${API_KEY}`);
        const p_oro = parseFloat(d_oro.data[0].value);
        document.getElementById('p-oro').innerText = "$" + p_oro.toFixed(2);
        crearMiniGrafica('chart-oro', 'Oro', d_oro.data.slice(0, 10).map(d => d.value).reverse(), '#fbbf24');

        // 3. Plata
        const d_plata = await fetchAPI(`https://www.alphavantage.co/query?function=SILVER&interval=monthly&apikey=${API_KEY}`);
        const p_plata = parseFloat(d_plata.data[0].value);
        document.getElementById('p-plata').innerText = "$" + p_plata.toFixed(2);
        crearMiniGrafica('chart-plata', 'Plata', d_plata.data.slice(0, 10).map(d => d.value).reverse(), '#94a3b8');

        // 4. DÃ³lar (EUR/USD)
        const d_dolar = await fetchAPI(`https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=EUR&to_currency=USD&apikey=${API_KEY}`);
        const p_dolar = parseFloat(d_dolar['Realtime Currency Exchange Rate']['5. Exchange Rate']);
        document.getElementById('p-dolar').innerText = "$" + p_dolar.toFixed(4);
        crearMiniGrafica('chart-dolar', 'DÃ³lar', [1.07, 1.09, 1.08, p_dolar], '#38bdf8');

    } catch (e) {
        console.error(e);
        alert("Aviso: Has superado las 5 consultas por minuto. Espera un momento y refresca.");
    }
}

// Iniciar al cargar
actualizarTodo();
</script>
</body>
</html>
